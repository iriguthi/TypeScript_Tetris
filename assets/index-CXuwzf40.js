(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function a(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?r.credentials="include":e.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(e){if(e.ep)return;e.ep=!0;const r=a(e);fetch(e.href,r)}})();const f=10,l=20;let s=Array.from({length:l},()=>Array(f).fill(0));const g=[{shape:[[1,1],[1,1]],x:0,y:0,color:"yellow"},{shape:[[1,1,1,1]],x:0,y:0,color:"Cyan"},{shape:[[1,1,0],[0,1,1]],x:0,y:0,color:"red"},{shape:[[0,1,1],[1,1,0]],x:0,y:0,color:"green"},{shape:[[1,1,1],[0,1,0]],x:0,y:0,color:"purple"},{shape:[[1,0,0],[1,1,1]],x:0,y:0,color:"orange"},{shape:[[0,0,1],[1,1,1]],x:0,y:0,color:"blue"}],w=()=>{var t,n;const a=Math.floor(Math.random()*g.length),o={...g[a]};if(!o.shape||o.shape.length===0)throw new Error("テトロミノのshapeが不正です");const e=(n=(t=o.shape[0])===null||t===void 0?void 0:t.length)!==null&&n!==void 0?n:1;return o.x=Math.floor((f-e)/2),o};let i=w();function y(){const t=document.getElementById("tetris_container");t.innerHTML="",A();for(let n=0;n<l;n++)for(let a=0;a<f;a++){const o=document.createElement("div");o.className="cell";const e=i.shape.some((r,c)=>r.some((u,h)=>u===1&&i.x+h===a&&i.y+c===n));(s[n][a]===1||e)&&(o.classList.add("filled"),o.style.backgroundColor=e?i.color:"gray"),t.appendChild(o)}}function A(){i.shape.forEach((t,n)=>{t.forEach((a,o)=>{if(a===1){const e=i.x+o,r=i.y+n;e>=0&&e<f&&r>=0&&r<l&&s[r]!==void 0&&s[r][e]!==void 0&&s[r][e]===2&&(s[r][e]=0)}})})}function v(){i.shape.forEach((t,n)=>{t.forEach((a,o)=>{if(a===1){const e=i.x+o,r=i.y+n;(e>=0||e<f||r>=0||r<l)&&s[r]!==void 0&&s[r][e]!==void 0&&(s[r][e]=2)}})})}function I(){i.shape.forEach((n,a)=>{n.forEach((o,e)=>{if(o===1){const r=i.x+e,c=i.y+a;r>=0&&r<f&&c>=0&&c<l&&s[c]!==void 0&&s[c][r]!==void 0&&(s[c][r]=1,s[c][r]===2&&(s[c][r]=0))}})}),O(),i.y===0&&(clearInterval(m),alert("GAME OVER")),i=w()}let x=0;function O(){s=s.filter(n=>n.some(a=>a===0));const t=l-s.length;for(x+=t*100,document.getElementById("score").innerText=`${x}`;s.length<l;)s.unshift(Array(f).fill(0))}function E(){b(0,1)?i.y+=1:I(),v(),y()}let T=1e3,m=setInterval(E,T);function b(t,n){return i.shape.every((a,o)=>a.every((e,r)=>{var c;if(e===0)return!0;const u=i.x+r+t,h=i.y+o+n;return!(u<0||u>=f||h>=l||((c=s[h])===null||c===void 0?void 0:c[u])===1)}))}function _(t){return t.every((n,a)=>n.every((o,e)=>{var r;if(o===0)return!0;const c=i.x+e,u=i.y+a;return!(c<0||c>=f||u>=l||((r=s[u])===null||r===void 0?void 0:r[c])===1)}))}function L(){for(let t=0;t<l;t++)for(let n=0;n<f;n++)s[t][n]===2&&(s[t][n]=0);v()}function p(t,n){b(t,n)&&(i.x+=t,i.y+=n),L(),y()}function M(){const t=P(i.shape);_(t)&&(i.shape=t,L(),y())}function P(t){return t.length===0?[]:t[0].map((n,a)=>t.map(o=>{var e;return(e=o[a])!==null&&e!==void 0?e:0}).reverse())}let d=!1;function C(){d?(m=setInterval(E,T),d=!1):(clearInterval(m),d=!0)}document.addEventListener("keydown",N);function N(t){switch(t.key){case"ArrowLeft":d||p(-1,0);break;case"ArrowRight":d||p(1,0);break;case"ArrowDown":d||p(0,1);break;case"ArrowUp":d||M();break;case" ":C();break}}v();y();
