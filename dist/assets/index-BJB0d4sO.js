(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function s(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?r.credentials="include":e.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(e){if(e.ep)return;e.ep=!0;const r=s(e);fetch(e.href,r)}})();const f=10,l=20;let a=Array.from({length:l},()=>Array(f).fill(0));const g=[{shape:[[1,1],[1,1]],x:0,y:0,color:"yellow"},{shape:[[1,1,1,1]],x:0,y:0,color:"Cyan"},{shape:[[1,1,0],[0,1,1]],x:0,y:0,color:"red"},{shape:[[0,1,1],[1,1,0]],x:0,y:0,color:"green"},{shape:[[1,1,1],[0,1,0]],x:0,y:0,color:"purple"},{shape:[[1,0,0],[1,1,1]],x:0,y:0,color:"orange"},{shape:[[0,0,1],[1,1,1]],x:0,y:0,color:"blue"}],w=()=>{var t,n;const s=Math.floor(Math.random()*g.length),i={...g[s]};if(!i.shape||i.shape.length===0)throw new Error("テトロミノのshapeが不正です");const e=(n=(t=i.shape[0])===null||t===void 0?void 0:t.length)!==null&&n!==void 0?n:1;return i.x=Math.floor((f-e)/2),i};let o=w();function y(){const t=document.getElementById("tetris_container");t.innerHTML="",A();for(let n=0;n<l;n++)for(let s=0;s<f;s++){const i=document.createElement("div");i.className="cell";const e=o.shape.some((r,c)=>r.some((u,h)=>u===1&&o.x+h===s&&o.y+c===n));(a[n][s]===1||e)&&(i.classList.add("filled"),i.style.backgroundColor=o.color),t.appendChild(i)}}function A(){o.shape.forEach((t,n)=>{t.forEach((s,i)=>{if(s===1){const e=o.x+i,r=o.y+n;e>=0&&e<f&&r>=0&&r<l&&a[r]!==void 0&&a[r][e]!==void 0&&a[r][e]===2&&(a[r][e]=0)}})})}function v(){o.shape.forEach((t,n)=>{t.forEach((s,i)=>{if(s===1){const e=o.x+i,r=o.y+n;(e>=0||e<f||r>=0||r<l)&&a[r]!==void 0&&a[r][e]!==void 0&&(a[r][e]=2)}})})}function I(){o.shape.forEach((n,s)=>{n.forEach((i,e)=>{if(i===1){const r=o.x+e,c=o.y+s;r>=0&&r<f&&c>=0&&c<l&&a[c]!==void 0&&a[c][r]!==void 0&&(a[c][r]=1,a[c][r]===2&&(a[c][r]=0))}})}),O(),o.y===0&&(clearInterval(m),alert("GAME OVER")),o=w()}let x=0;function O(){a=a.filter(n=>n.some(s=>s===0));const t=l-a.length;for(x+=t*100,document.getElementById("score").innerText=`${x}`;a.length<l;)a.unshift(Array(f).fill(0))}function E(){b(0,1)?o.y+=1:I(),v(),y()}let T=1e3,m=setInterval(E,T);function b(t,n){return o.shape.every((s,i)=>s.every((e,r)=>{var c;if(e===0)return!0;const u=o.x+r+t,h=o.y+i+n;return!(u<0||u>=f||h>=l||((c=a[h])===null||c===void 0?void 0:c[u])===1)}))}function _(t){return t.every((n,s)=>n.every((i,e)=>{var r;if(i===0)return!0;const c=o.x+e,u=o.y+s;return!(c<0||c>=f||u>=l||((r=a[u])===null||r===void 0?void 0:r[c])===1)}))}function L(){for(let t=0;t<l;t++)for(let n=0;n<f;n++)a[t][n]===2&&(a[t][n]=0);v()}function p(t,n){b(t,n)&&(o.x+=t,o.y+=n),L(),y()}function M(){const t=P(o.shape);_(t)&&(o.shape=t,L(),y())}function P(t){return t.length===0?[]:t[0].map((n,s)=>t.map(i=>{var e;return(e=i[s])!==null&&e!==void 0?e:0}).reverse())}let d=!1;function C(){d?(m=setInterval(E,T),d=!1):(clearInterval(m),d=!0)}document.addEventListener("keydown",N);function N(t){switch(t.key){case"ArrowLeft":d||p(-1,0);break;case"ArrowRight":d||p(1,0);break;case"ArrowDown":d||p(0,1);break;case"ArrowUp":d||M();break;case" ":C();break}}v();y();
