(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))l(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const o of t.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&l(o)}).observe(document,{childList:!0,subtree:!0});function i(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function l(e){if(e.ep)return;e.ep=!0;const t=i(e);fetch(e.href,t)}})();const f=10,c=20;let s=Array.from({length:c},()=>Array(f).fill(0));const T=[{shape:[[1,1],[1,1]],x:0,y:0,color:"yellow"},{shape:[[1,1,1,1]],x:0,y:0,color:"Cyan"},{shape:[[1,1,0],[0,1,1]],x:0,y:0,color:"red"},{shape:[[0,1,1],[1,1,0]],x:0,y:0,color:"green"},{shape:[[1,1,1],[0,1,0]],x:0,y:0,color:"purple"},{shape:[[1,0,0],[1,1,1]],x:0,y:0,color:"orange"},{shape:[[0,0,1],[1,1,1]],x:0,y:0,color:"blue"}],b=()=>{var r,n;const i=Math.floor(Math.random()*T.length),l={...T[i]};if(!l.shape||l.shape.length===0)throw new Error("テトロミノのshapeが不正です");const e=(n=(r=l.shape[0])===null||r===void 0?void 0:r.length)!==null&&n!==void 0?n:1;return l.x=Math.floor((f-e)/2),l};let a=b(),v=b();function I(){var r;const n=document.getElementById("next_tetromino");n.innerHTML="";const{shape:i,color:l}=v;n.style.gridTemplateColumns=`repeat(${(r=i[0])===null||r===void 0?void 0:r.length}, 20px)`;for(let e=0;e<i.length;e++)for(let t=0;t<i[e].length;t++){const o=document.createElement("div");o.style.width="20px",o.style.height="20px",o.style.boxSizing="border-box",o.style.border="1px solid #ccc",i[e][t]===1?o.style.backgroundColor=l:o.style.border="none",n.appendChild(o)}}function m(){const r=document.getElementById("tetris_container");r.innerHTML="",_();for(let n=0;n<c;n++)for(let i=0;i<f;i++){const l=document.createElement("div");l.className="cell";const e=a.shape.some((t,o)=>t.some((u,y)=>u===1&&a.x+y===i&&a.y+o===n));(s[n][i]===1||e)&&(l.classList.add("filled"),l.style.backgroundColor=e?a.color:"gray"),r.appendChild(l)}}function _(){a.shape.forEach((r,n)=>{r.forEach((i,l)=>{if(i===1){const e=a.x+l,t=a.y+n;e>=0&&e<f&&t>=0&&t<c&&s[t]!==void 0&&s[t][e]!==void 0&&s[t][e]===2&&(s[t][e]=0)}})})}function E(){a.shape.forEach((r,n)=>{r.forEach((i,l)=>{if(i===1){const e=a.x+l,t=a.y+n;(e>=0||e<f||t>=0||t<c)&&s[t]!==void 0&&s[t][e]!==void 0&&(s[t][e]=2)}})})}function A(){a.shape.forEach((n,i)=>{n.forEach((l,e)=>{if(l===1){const t=a.x+e,o=a.y+i;t>=0&&t<f&&o>=0&&o<c&&s[o]!==void 0&&s[o][t]!==void 0&&(s[o][t]=1,s[o][t]===2&&(s[o][t]=0))}})}),C(),a.y===0&&(clearInterval(h),alert("GAME OVER")),a=v,v=b(),I()}let x=0;function C(){s=s.filter(n=>n.some(i=>i===0));const r=c-s.length;for(x+=r*100,document.getElementById("score").innerText=`${x}`,O();s.length<c;)s.unshift(Array(f).fill(0))}function w(){L(0,1)?a.y+=1:A(),E(),m()}let p=1e3,h=setInterval(w,p);function O(){p=Math.max(1e3-Math.floor(x/1e3)*100,100),clearInterval(h),h=setInterval(w,p)}function L(r,n){return a.shape.every((i,l)=>i.every((e,t)=>{var o;if(e===0)return!0;const u=a.x+t+r,y=a.y+l+n;return!(u<0||u>=f||y>=c||((o=s[y])===null||o===void 0?void 0:o[u])===1)}))}function N(r){return r.every((n,i)=>n.every((l,e)=>{var t;if(l===0)return!0;const o=a.x+e,u=a.y+i;return!(o<0||o>=f||u>=c||((t=s[u])===null||t===void 0?void 0:t[o])===1)}))}function M(){for(let r=0;r<c;r++)for(let n=0;n<f;n++)s[r][n]===2&&(s[r][n]=0);E()}function g(r,n){L(r,n)&&(a.x+=r,a.y+=n),M(),m()}function P(){const r=S(a.shape);N(r)&&(a.shape=r,M(),m())}function S(r){return r.length===0?[]:r[0].map((n,i)=>r.map(l=>{var e;return(e=l[i])!==null&&e!==void 0?e:0}).reverse())}let d=!1;function R(){d?(h=setInterval(w,p),d=!1):(clearInterval(h),d=!0)}document.addEventListener("keydown",k);function k(r){switch(r.key){case"ArrowLeft":d||g(-1,0);break;case"ArrowRight":d||g(1,0);break;case"ArrowDown":d||g(0,1);break;case"ArrowUp":d||P();break;case" ":R();break}}E();m();I();
